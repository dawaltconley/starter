{% assign id = include.on %}
{% if include.type %}
  {% assign type = include.type %}
{% else %}
  {% assign type = 'comment' %}
{% endif %}

<form class="margin-m-b text-wrapper" action="https://7uoj7r2as8.execute-api.us-east-1.amazonaws.com/default" method="post" data-content-type="application/json" data-comment-form>
  <input type="hidden" name="replyTo" value="{{ id }}">
  <textarea class="block full-width" name="comment" placeholder="Leave a {{ type }}..."></textarea>
  <div class="flex-row flex-align-center margin-s-t h-rhythm">
    <input type="text" class="full-width" name="name" placeholder="Name">
    <input type="text" class="full-width" name="email" placeholder="Email">
    <button type="submit" class="button cursor-pointer">Submit</button>
  </div>
  <label class="flex-row flex-align-center margin-s-t text-light fs-smaller">
    <input type="checkbox" data-save="name email">
    <span>Remember me</span>
  </label>
</form>

<ul class="unlist v-rhythm border-around fs-smaller">
  {% assign sorted_comments = site.comments | where: 'replyTo', id | sort: 'date' | reverse %}
  {% for comment in sorted_comments %}
    <li class="margin-0-v padding-m-v border-basic border-light">
      <div class="margin-0-b ff-heading">
        {{ comment.name }}
        <time class="text-light" datetime="{{ comment.date | date_to_xmlschema }}">
          &bull; {{ comment.date | date: "%b %-d, %Y" }}
        </time>
      </div>

      <div class="margin-xs-b">
        {% assign content = comment.content | markdownify %}
        {{ content }}
      </div>

      <details>
        {% assign summary = 'Reply' %}
        {% assign replies = site.comments | where: 'replyTo', comment.id | size %}
        {% if replies == 1 %}
          {% assign summary = '1 reply' %}
        {% elsif replies > 1 %}
          {% assign summary = replies | append: ' replies' %}
        {% endif %}
        <summary class="text-light">{{ summary }}</summary>
        <div class="indented margin-s-t fs-base">
          {% include comment-form.html on=comment.id type='reply' %}
        </div>
      </details>
    </li>
  {% endfor %}
</ul>
